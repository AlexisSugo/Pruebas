webpackJsonp([12],{28:function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=a(2);a.n(t),a(0);window.SUGOReferrals=function(e,r,a){function t(){n=this,n.email="",n.referralsPeople=[],n.Referrals.init()}var n,o={init:function(){var r=this;e(document).ready(function(){r.getDataUserSession(),r.events(),r.triggers()})},events:function(){e(".referrals").off().on("click","#sendInviteButton",function(){var r=e("#sendInviteInput").val();n.Referrals.checkMail(r)?n.Referrals.checkIfUserCanBeReferred(r).then(function(a){var t=a.status,o=a.exist,s=a.msj;t?(e(".sendInviteError").empty(),e("#sendInviteButton").removeClass("error"),o?n.Referrals.updateClientReferred(r):n.Referrals.createClientReferred(r),n.Referrals.createInReferrals(r),n.Referrals.updateClientReferrer(n.email),e("#sendInviteInput").val("")):(e(".sendInviteError").empty().append("<span>".concat(s,"</span>")),e("#sendInviteButton").addClass("error"))}).catch(function(e){console.error(e)}):e(".sendInviteError").empty().append("<span>Email con formato invalido</span>")}).on("click",".socialSharing .copy",function(r){r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),e(".shareLinkContainer .shareLink").select(),document.execCommand("copy"),e(".shareLinkContainer .shareLink").blur()}),e(document).on("click",".termsAndConditions button",function(){e(".modal").addClass("active")}).on("click",".close-content-tyc",function(){e(".modal").removeClass("active")}).on("click",".modal",function(r){0===e(r.target).parents(".contentTermsWizard").length&&e(".modal").removeClass("active")}).on("click","a.vtex-account_menu-link:last-child",function(e){n.Referrals.signOutSession(n.Referrals.getLoginURL())})},triggers:function(){e(document).on("referrals:rendered",function(e){console.log("referrals:rendered")})},getDataUserSession:function(){e(r).on("orderFormUpdated.vtex",function(e,r){r.clientProfileData&&r.clientProfileData.email&&!n.email&&(n.email=r.clientProfileData.email,n.Referrals.loadReferreds(),n.Referrals.loadRewards(),n.Referrals.loadSocialSharing(),n.Referrals.loadMenu(r.clientProfileData))}),vtexjs.checkout.getOrderForm()},loadReferreds:function(){e.get("/api/dataentities/RF/search?_fields=id,referredBought,referred,referrer,active&_where=referrer=".concat(n.email)).done(function(e){n.referralsPeople=e.sort(function(e,r){return e.referredBought?-1:1}),n.Referrals.compile()}).fail(function(e){console.error(e)})},compile:function(){try{if(e("#referrals-people-template").length){var r=e("#referrals-people-template").html(),a=Handlebars.compile(r),t=a({referralsPeople:n.referralsPeople});e(".listPeople").empty().append(t),setTimeout(function(){e(document).trigger("referrals:rendered")},100)}}catch(e){console.error(e)}},loadRewards:function(){e.get("/api/dataentities/CL/search?_fields=id,firstName,ref_level1,ref_level1_reward,ref_level2,ref_level2_reward,ref_level3,ref_level3_reward&_where=email=".concat(n.email)).done(function(e){e&&e.length?(n.referrerName=e[0].firstName?e[0].firstName:"alguien",n.referrerRewards=e,n.Referrals.setRewards()):console.error("error al obtener la data del cliente",e)}).fail(function(e){console.error(e)})},setRewards:function(){n.referrerRewards&&n.referrerRewards.length&&(n.referrerRewards[0].ref_level1&&(e(".levelReward .level1").addClass("available"),n.referrerRewards[0].ref_level1_reward&&e(".levelReward .level1").addClass("used")),n.referrerRewards[0].ref_level2&&(e(".levelReward .level2").addClass("available"),n.referrerRewards[0].ref_level2_reward&&e(".levelReward .level2").addClass("used")),n.referrerRewards[0].ref_level3&&(e(".levelReward .level3").addClass("available"),e(".goalReward h3").addClass("active"),n.referrerRewards[0].ref_level3_reward&&e(".levelReward .level3").addClass("used")))},checkMail:function(e){var r=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.match(r)},checkIfUserCanBeReferred:function(r){return new Promise(function(a,t){r==n.email?a({status:!1,exist:!0,msj:"No te puedes referir a ti mismo"}):e.get("/api/dataentities/CL/search?_fields=email,estadoUsuario,referred,referrer&_where=email=".concat(r)).done(function(t){t.length?t[0].referred?a({status:!1,exist:!0,msj:"Este usuario ya fue referido."}):t[0].referrer?a({status:!1,exist:!0,msj:"Este usuario es un referente y no puede ser un referido"}):t[0].estadoUsuario?a(t[0].estadoUsuario.indexOf("Primera Compra")>-1||t[0].estadoUsuario.indexOf("Usuario Recurrente")>-1?{status:!1,exist:!0,msj:"Este usuario ya se encuentra registrado en nuestro ecommerce"}:{status:!0,exist:!0,msj:"Usuario habilitado"}):e.get("/api/dataentities/RF/search?_fields=referrer,referred&_where=referrer=".concat(r," OR referred=").concat(r)).done(function(e){a(e.length?e[0].referred==r?{status:!1,exist:!1,msj:"Este usuario ya fue referido."}:e[0].referrer==r?{status:!1,exist:!1,msj:"Este usuario es un referente y no puede ser un referido"}:{status:!1,exist:!1,msj:"Este usuario ya se encuentra registrado en nuestro ecommerce"}:{status:!0,exist:!0,msj:"Usuario habilitado"})}).fail(function(e){console.error(e)}):e.get("/api/dataentities/RF/search?_fields=referrer,referred&_where=referrer=".concat(r," OR referred=").concat(r)).done(function(e){a(e.length?e[0].referred==r?{status:!1,exist:!1,msj:"Este usuario ya fue referido por otra persona."}:e[0].referrer==r?{status:!1,exist:!1,msj:"Este usuario es un referente y no puede ser un referido"}:{status:!1,exist:!1,msj:"Este usuario ya se encuentra registrado en nuestro ecommerce"}:{status:!0,exist:!1,msj:"Usuario habilitado"})}).fail(function(e){console.error(e)})}).fail(function(e){console.error(e),t({status:!1})})})},updateClientReferred:function(r){e.ajax({type:"PATCH",url:"/api/dataentities/CL/documents",data:JSON.stringify({email:r,referred:!0}),contentType:"application/json"}).done(function(e){console.log("actualizado en tabla de clientes",e)}).fail(function(e){console.error(e)})},updateClientReferrer:function(r){e.ajax({type:"PATCH",url:"/api/dataentities/CL/documents",data:JSON.stringify({email:r,referrer:!0}),contentType:"application/json"}).done(function(e){console.log("actualizado en tabla de clientes",e)}).fail(function(e){console.error(e)})},createClientReferred:function(r){e.ajax({type:"PATCH",url:"/api/dataentities/CL/documents",contentType:"application/json",data:JSON.stringify({email:r,rol:0,estadoUsuario:"Referido",company:"11111111119",active:!0,referred:!0})}).done(function(e){console.log("creado en tabla de clientes",e)}).fail(function(e){console.error(e)})},createInReferrals:function(r){e.ajax({type:"PATCH",url:"/api/dataentities/RF/documents",data:JSON.stringify({referred:r,referrer:n.email,referrerName:n.referrerName}),contentType:"application/json"}).done(function(e){console.log("creado en tabla de referidos",e),n.referralsPeople.push({referredBought:!1,referred:r,referrer:n.email}),n.Referrals.compile()}).fail(function(e){console.error(e)})},loadSocialSharing:function(){e(".whatsapp").attr("href","https://wa.me/?text=".concat(encodeURIComponent("Te regalo S/30 y el envío gratis para usar en tu primera compra de S/100 o más en Sugo, una tienda con preciazos en las mejores marcas ¡No pierdas esta oportunidad, tienes hasta el 30 de noviembre!\n Elige tu regalo -> https://www.sugo.com/?ReturnUrl=%2Fhome&referrer=".concat(n.Referrals.utf8_to_b64(n.email))))),e(".copy").attr("href",""),e(".shareLinkContainer .shareLink").val("Te regalo S/30 y el envío gratis para usar en tu primera compra de S/100 o más en Sugo, una tienda con preciazos en las mejores marcas ¡No pierdas esta oportunidad, tienes hasta el 30 de noviembre!\n Elige tu regalo -> https://www.sugo.com/?ReturnUrl=%2Fhome&referrer=".concat(n.Referrals.utf8_to_b64(n.email)))},utf8_to_b64:function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,r){return String.fromCharCode("0x"+r)}))},loadMenu:function(r){r&&r.firstName&&r.lastName&&(e(".vtex-account__menu-links #loggedUser").addClass("active"),e(".userName").html("Hola, <br />".concat(r.firstName,"!")))},signOutSession:function(r){return e.ajax({type:"get",url:"/no-cache/user/logout"}).done(function(a){e.get(vtexjs.checkout.getLogoutURL()),location.replace(r)}).fail(function(e){})},getLoginURL:function(){return"/?ReturnUrl="+encodeURIComponent(r.location.href.replace(r.location.origin,""))}};return t.prototype.Referrals=o,new t(this)}(jQuery,window)}},[28]);
//# sourceMappingURL=SG-Referidos.bundle.min.js.map